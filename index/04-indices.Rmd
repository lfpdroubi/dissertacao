# Índices de preços e indicadores de performance do \gls{MI} {#indices}

## Índices de preços de imóveis

Diversos países hoje contam com índices de preços de imóveis nacionais, oficiais
ou não, no entanto o modo de construção destes índices de preços difere de país 
para país, assim como variam as estruturas de oferta e demanda em cada um deles
[@regulation, 3-4].

No Brasil recentemente foram criados alguns índices de preços de imóveis, 
contudo, deve-se ter em conta, na criação de um índice de preços qualquer, a que
objetivo ele se destina e, como se verá, isto parece não ter sido levado em 
conta na criação dos índices de preços de imóveis brasileiros.

De acordo com o @rppi, índices de preços de imóveis são importantes e podem ser
úteis ou necessários:

* como um indicador macroeconômio da atividade econômica;
* para uso na calibração da política monetária;
* como uma ferramenta para estimar o valor de um dos componentes de riqueza;
* como um indicador da estabilidade financeira ou de solidez da exposição ao 
risco;
* como um deflator nas contas nacionais;
* para auxílio para a tomada de decisões dos cidadãos na negociação de um imóvel;
* como um dos componentes de um índice de preços ao consumidor; e
* para uso em comparações inter-setoriais ou internacionais.

Ainda segundo o @rppi, grosseiramente falando, os índices de preços podem ser 
divididos em dois grupos:

* índices para a aferição do *estoque* de propriedade imobiliária em um
determinado tempo; e 
* índices para a aferição das *vendas* de propriedade imobiliária em um 
determinado período de tempo.

Em síntese, índices do primeiro tipo devem conter informação tanto das
propriedades existentes e das propriedades recém-construídas, enquanto que para
índices do segundo tipo apenas, destinado a medir o investimento imobiliário,
deve se ater às vendas de novos imóveis ou imóveis recém convertidos em imóveis
de novo tipo [@rppi, 155]. 

Contudo, deve-se ter em conta que para aferir o investimento bruto no \gls{MI} 
deve-se primeiro decompor o componente estrutural do componente
referente ao preço da terra no valor de venda dos imóveis [@rppi, 155]. Esta
decomposição também deve ser efetuada para utilização do índice como um
componente de um índice de preços ao consumidor [@rppi, 156].

No Brasil existe uma grande dificuldade para a confecção de plantas genéricas
para a constituição da base de cálculo do \gls{IPTU}. Em diversas cidades é
comum que as \gls{PVG} não sejam atualizadas por muitos anos, o que acaba
distorcendo muito a \gls{PVG} em relação aos valores reais de mercado. O que
agrava ainda mais a situação é que as bases de cálculo acabam sendo atualizadas
por índices de preços ao consumidor, como o \gls{IPCA}. O efeito disto é que, em
períodos em que os preços dos imóveis aumentam mais do que o \gls{IPCA} em média
(ou qualquer quer seja o índice de preço adotado), a base da tributação acaba
deprimida e vice-versa, se o aumento do \gls{IPCA} é muito alto, o aumento da
base de cálculo do \gls{IPTU} acaba por sobrecarregar ainda mais os
proprietários. A elaboração de índices de preços de imóveis pode ajudar a 
resolver este problema.

### Metodologias para confecção de índices de preços de imóveis

Diferentes metodologias são conhecidas para a confecção de índices de preços de
imóveis, que vão desde as mais simples, como o método de vendas repetidas, 
proposto por Case e Shiller [-@repeatedSales], até métodos mais complexos, com
modelos hedônicos, com os quais é possível decompor os preços dos imóveis em
preços de terra e preços de estruturas.

A opção pela aplicação de cada método não se dá apenas pela maior ou menor
precisão ou complexidade de cada índice, mas deve se dar pelos aspectos do
\gls{MI} em referência e em relação à finalidade do índice. O índice de Case e
Shiller, um dos mais conhecidos, se aplica perfeitamente ao \gls{MI} americano,
dado este é um mercado muito dinâmico, onde a compra e venda de imóveis é feita
com considerável frequência, o que permite a utilização do índice, que se baseia
em vendas repetidas de um mesmo imóvel. É provável, portanto, que este índice
não se adapte à países com \gls{MI} menos complexos, como o Brasil, onde ainda
existe grande informalidade e as transações muitas vezes nem são comunicadas às
entidades reguladoras, dado que diversas transações são feitas baseadas em
simples contratos particulares de compra e venda.

#### Métodos de estratificação

São os métodos mais simples de medição de mudanças nos índices de preços de 
imóveis. É feita pela aferição da mudança de uma medida de tendência central 
(usualmente média ou mediana) em um determinado período de tempo, dividindo-se
os imóveis em sub-amostras de características similares.

Um dos problemas da utilização deste tipo de metodologia é que ele é incapaz
de capturar eventuais mudanças quanto a qualidade do estoque de imóveis ao longo
do tempo, ficando viesado para cima, por exemplo, quando a qualidade dos imóveis
aumenta ao longo do tempo e vice-versa. O índice tambem pode ficar viesado se
houver alteração no *mix* de imóveis entre dois períodos, por exemplo, se num
determinado período houver um maior número de imóveis de alto padrão do que 
num período anterior, o índice ficará viesado para cima.

Segundo o Eurostat [-@rppi, 158], o método da estratificação é recomendado quando o
volume de vendas é grande o suficiente e a informação das características dos
imóveis é detalhada o suficiente para uma classificação detalhada das
propriedades, sendo este método de confecção de índice somente apropriado quando:

* um nível apropriado de detalhe escolhido é factível para as células 
* uma das variáveis de estratificação é a variável *idade* da edificação; e
* a decomposição do índice em terra e estrutura não é necessária.

#### Métodos hedônicos

É o método mais eficiente de construção de um índice quando há dados
disponíveis. Além de explorar o máximo os dados disponíveis, permite a
desagragação dos preços das estruturas do preço da terra e pode ser elaborado de
forma a levar em conta a depreciação dos imóveis, razão pela qual tal tipo
índice pode ser utilizado tanto para o monitoramento do valor dos estoques de
imóveis quanto para aferir o investimento no setor imobiliário.

Consiste na aplicação de modelos hedônicos, basicamente de duas maneiras distintas:

##### Modelos com variáveis dicotômicas de tempo 

Trata-se de um método que utiliza um modelo de regressão onde as variáveis
hedônicas dos imóveis são adicionadas de variáveis dicotômicas de cada período
[@rppi, 158]. Apesar da simplicidade, uma vez que um novo período é adicionado,
com o novo ajuste do modelo, os índices dos períodos anteriores são modificados.
Para contornar este problema, utiliza-se uma janela de tempo móvel, efetuando um
ajuste de modelo para os últimos N períodos.

##### Modelos de preços característicos

Nestes tipos de índices, um modelo hedônico é ajustado a cada período e o índice
é construído através dos preços previstos pelos modelos [@rppi, 53]. Assim, o
índice é construído através da razão entre os preços previstos nos dois
períodos, como mostra a equação \@ref(eq:cp-approach).

\begin{equation}
\frac{\hat p^t}{\hat p^0} = \frac{\hat \beta_0^t + \sum \hat \beta_k^t z_k^*}{\hat \beta_0^0 + \sum \hat \beta_k^0 z_k^*}
(\#eq:cp-approach)
\end{equation}

onde as características dos imóveis $z_k^*$ pode ser estabelecida de diversas
maneiras, como a média das características do período base ($z_k^* = \bar z_k^0$),
denominado índice de Laspeyres, como média das características do período
posterior ($z_k^* = \bar z_k^t$), denominado índice de Paasche, ou ainda tomando
a média geométrica dos períodos anterior e posterior, denominado índice do tipo
Fisher.

#### Método de vendas repetidas (Repeated Sales)

Embora seja o método mais "natural" para a confecção de um índice, e de ser
também o método do índice talvez mais famoso, o de Case e Shiller, o método de
vendas repetidas não é tão eficiente quanto o método de modelos hedônicos, pois
o método de vendas repetidas, ao utilizar apenas os dados de imóveis
transacionados mais de uma vez, por conseguinte descarta muitos dados de
transação que poderiam ser úteis para a construção de um índice mais robusto 
[@rppi, 160]. 

#### Métodos baseados em avaliação -- Sales Price Appraisal Ratio (SPAR)

Este tipo de índice utiliza de dados de avaliação feitas para propósito de
tributação ou outros tipos de avaliação, usualmente utilizadas para bens 
similares, com o intuito de resolver alguns problemas relacionados ao modelo de
vendas repetidas (pequeno número de dados repetidos e a suscetibilidade ao viés).
Matematicamente, o índice é calculado de acordo com a equação \@ref(eq:AP) 
[@rppi, 75].

\begin{equation}
P_{AP}^{0t} = \sum_{n \in S(t)} w_n^0(t) \left ( \frac{p_n^t}{a_n^0} \right )
(\#eq:AP)
\end{equation}

onde $p_n^t$ é o preço de venda no período $t$, $a_n^0$ é o valor da avaliação
do bem no período base, $S(t)$ é a amostra do período $t$ e $w_n^0(t)$ são os
pesos utilizados para a confecção do índice.

Ou seja, este método, como uma maneira de contornar o baixo volume de dados de 
venda de bens nos diferentes períodos, compensa essa falta de dados com a 
utilização de dados de avaliação, nos períodos onde não há dados de venda.

Como o método acima não utiliza valores observados no período base, os valores
neste período, como acima calculados, serão diferentes de 1. Como isto é 
indesejável, uma normalização é feita, obtendo-se assim o *Sales Price Appraisal
Ratio* ou SPAR, cuja formulação pode ser vista na equação \@ref(eq:SPAR) 
[@rppi, 75]:

\begin{equation}
P_{SPAR}^{0t} = \frac{\sum\limits_{n \in S(t)} p_n^t}{\sum\limits_{n \in S(t)} a_n^0} \left [ \frac{\sum\limits_{n \in S(0)} p_n^0}{\sum\limits_{n \in S(0)} a_0^n} \right ]^{-1}
(\#eq:SPAR)
\end{equation}

Apesar de ser simples, necessitar apenas de dados de preços e avaliações, o que
simplifica a sua computação, os métodos baseados em avaliações tem a desvantagem
de não lidar adequadamente com mudanças de qualidade entre os períodos (reparos 
ou depreciação), além de ser dependente da qualidade das avaliações. 

Uma característica interessante deste tipo de índices é que, quando o cadastro
está atualizado e podem ser utilizados, os dados utilizados para a confecção do
índice representam a totalidade da população e não apenas uma amostra, como de
costume, ou seja, não há erro amostral, apenas o erro devido à avaliação em si.

Uma limitação importante, porém, é que índices elaborados com tais métodos não
podem decompor o valor total da propriedade imobiliária em valor de terra e
valor de estruturas.

### Índices no mundo

O @rppi elencou uma série de índices ao redor do mundo. Nesta subseção, alguns destes índice são descritos.

#### Índices globais

##### Global Real House Price Index

O FMI, através do observatório Global Housing Watch...



#### Índices em países desenvolvidos

a. Índice de Case-Shiller

@NBERw2506 desenvolveram...

#### Índices em países em desenvolvimento

Nos países em desenvolvimento, segundo o o Eurostat [-@rppi, 110], uma proporção
significante dos imóveis advém de construção própria, em terrenos de família, 
muitas vezes incompletas, sendo que a construção de uma casa pode durar anos, as
fontes de financiamento são incertas, não há avaliações disponíveis, o que faz
ser impossível o cálculo dos valores de aquisição do imóvel.

Nestes casos, segundo o o Eurostat [-@rppi, 110], a única opção prática para
estimar o valor dos imóveis é através da equivalência dos valores de aluguéis.

#### Índices na América Latina

##### IPVU (Colômbia)

Desde 2003 [@rppi, 130]

#### Índices no Brasil

##### Índice FipeZap

O índice de maior longevidade que se tem conhecimento no Brasil foi elaborado em
conjunto pela Fundação Instituto de Pesquisas Econômicas (FIPE) e pelo portal de
anúncios de imóveis, o chamado índice FipeZap.

Segundo a @fipezap, a metodologia utilizada para o cálculo do índice é a
estratificação. Para o índice FipeZap, apenas dois critérios de estratificação
foram adotados, no caso dos imóveis residenciais, a saber, o número de
dormitórios e a área de ponderação, definida pelos critérios do IBGE. No caso de
imóveis comerciais, o único critério de estratificação é a localização
[@fipezap, 7].


De acordo com a @fipezap, não foi possível a inclusão da variável idade da
edificação, por esta não ser uma variável obrigatória nos anúncios da plataforma
zap imóveis.


Infelizmente, devido à sua metodologia e composição, o índice FipeZap não se
presta nem a aferir o estoque de riqueza, nem o investimento bruto no mercado
imobiliário, já que a variável idade não foi inserida na estratificação e não é
possível a decomposição do índice na parte estrutural e preço da terra, devido à
própria metodologia.

Outro problema relacionado a este índice é que ele não é composto de transações
de imóveis, porém de anúncios de imóveis, o que além de poder ser problemático é
questionável, devido aos diferentes descontos praticados no mercado em
diferentes períodos e pelos diferentes atores, que neste caso não são
mensuráveis. Segundo o o Eurostat [-@rppi, 126]:

\begin{citacao}
Although not related to the issue of timing, a disadvantage of advertised
prices and mortgage approvals is that not all of the prices included end in
transactions, and in the former case, the price will tend to be higher than the
fnal negotiated transaction price.
\end{citacao}

Outros problemas relacionados ao índice FipeZap, como se basear exclusivamente
em anúncios em websites, também são elencados pelo Eurostat [-@rppi, 104]:

\begin{citacao}
Information collected on a seller’s asking price cannot always be easily
verifed and, as well as depending on a balanced and representative sample,
relies on the honesty and knowledge of those being surveyed and when drawn from
advertisements, the accuracy of the information, especially when it is from a
website [...] It has also been argued that websites will tend to be biased
towards properties that have a competitive asking price to entice potential
sellers. All this is, of course, speculation but it does bring home some of the
potential dificulties associated with these sources.
\end{citacao}

##### Índices IGMI-R e IGMI-C

Trata-se de um novo conjunto de índices construídos pela \gls{ABECIP} em
convênio com o \gls{IBRE}/\gls{FGV}, provavelmente através de um método baseado
em avaliações, "levando em conta os laudos de imóveis financiados pelos bancos".


\begin{citacao}
Nos Estados Unidos, país de grande dimensão territorial e elevada mobilidade
da população, o índice Case-Schiller faz o cálculo através da metodologia das
transações repetidas. Outros países, que têm uma realidade diferente da
americana, buscam alternativas para fazer o cálculo.
\end{citacao}

## Indicadores de performance do setor imobiliário residencial

O Quadro \@ref(qua:Quadro-2) traz uma coleção de dez indicadores que podem 
ser utilizados para o diagnóstico e um comparativo do \gls{MI} residencial em 
um país com outros mercados em perspectiva [@indicators, 7].

\begin{quadro}[htb]
	\centering
	\caption{\label{qua:Quadro-2}Dez indicadores chave da performance do \gls{MI} residencial.}	
	\begin{tabular}{|p{5cm}|p{10cm}|}
		\hline
		\textbf{Indicador}        & \textbf{Definição}\\ \hline
		 Razão preço/renda        & Razão do preço mediano de uma casa e a renda 
		 mediana doméstica anual  \\ \hline
		 Razão aluguel/renda      & Razão do aluguel mediano anual de uma casa e a 
		 renda mediana anual doméstica dos locadores       \\ \hline
		 Produção de unidades     & Número total de unidades residenciais (formais e 
		 informais) produzida por ano por 1.000 habitantes       \\ \hline
		 Investimento residencial & Investimento total no \gls{MI} residencial, em 
		 porcentagem do \gls{PIB}       \\ \hline
		 Área útil por habitante  & Área útil total disponível por habitante \\ \hline
		 Estruturas permanentes   & Porcentagem de unidades residenciais em 
		 estruturas construídas por material permanente       \\ \hline
		 Estruturas irregulares   & Porcentagem do estoque total residencial na área 
		 urbana em desacordo com a regulamentação corrente.       \\ \hline
		 Carteira de crédito residencial & Razão do crédito total hipotecários em 
		 relação ao crédito total (instituições comerciais e governamentais)  \\ \hline
		 Multiplicador de terra loteada & Raiz média entre o preço mediano da terra 
		 loteada nos extremos urbanos em um loteamento típico e o preço mediano da 
		 terra nua, não loteada, próxima ao perímetro urbano       \\ \hline
		 Gastos com infraestrutura per capita & Razão dos gastos totais com 
		 infraestrutura durante o ano e a população urbana       \\ \hline
	\end{tabular}
	\fonte{\textcite[4]{indicators}.}
\end{quadro}

Outro índice importante para a caracterização de um \gls{MI} é um índice baseado
em regulação. Segundo @malpezzi_affordable_2018_5, é possível tomar conclusões a
respeito da regulação de um \gls{MI} de duas maneiras: a primeira, mais custosa,
é elaborar um estudo detalhado dos custos e benefícios das regulações impostas
em um \gls{MI} específico; a segunda é efetuar estudos comparativos dos efeitos
das medidas regulatórias em diferentes \gls{MI}.

o \gls{WRLURI} [@wharton]...

@externalities desenvolveu um índice próprio. 

## Variáveis macroeconômicas e variáveis do mercado imobiliário

Outros indicares importantes de performance do mercado imobiliário foram 
elencadas por @macroHousing. 

@macroHousing classificaram as variáveis importantes para a aferição do
comportamento do \gls{MI} e sua correlação com a Macroeconomia em variáveis
macroeconômicas -- \gls{MV} -- e variáveis do mercado residencial --  \gls{HMV}. 
Entre as \gls{MV} estão as variáveis macroeconômicas mais convencionais, como o
\gls{PIB}, a taxa de desemprego, taxa de inflação e outras, mas também o que 
@macroHousing chamaram de variáveis macro-financeiras, como as taxas de juros
básicas, sejam nominais ou reais, os índices das bolsas de valores (S&P 500), 
etc. Entre as \gls{HMV} encontram-se não apenas os índices de preços, mas também 
variáveis como o número de novas residências vendidas, a taxa de vacância e o 
investimento residencial.

A Figura \@ref(fig:vacancyRate) mostra a taxa de vacância de imóveis próprios (A)
e de aluguel (B) para os \gls{EUA}.

```{r}
RHVRUSQ156N <- fredr(series_id = "RHVRUSQ156N", 
               observation_start = as.Date("1956-01-01")) # Homeowner vacancy rate
USHOWN <- fredr(series_id = "RSAHORUSQ156S", 
               observation_start = as.Date("1984-01-01")) # Homeownership rate
NHPI <- fredr(series_id = "CSUSHPINSA", 
              observation_start = as.Date("1987-01-01"), 
              frequency = "q")
RRVRUSQ156N <- fredr(series_id = "RRVRUSQ156N", 
               observation_start = as.Date("1956-01-01")) # Rental vacancy rate
RHVRUSQ156N$date <- seq(ISOdate(1956,1,1), ISOdate(2020,4,1), by = "quarters")
RRVRUSQ156N$date <- seq(ISOdate(1956,1,1), ISOdate(2020,4,1), by = "quarters")
```

```{r recessionsDF4}
recessions.df <- read.csv("data/us_recessions.csv")
recessions.df <- within(recessions.df, {
  Peak <- as.POSIXct(Peak)
  Trough <- as.POSIXct(Trough)
  })
```

```{r format-quarters}
format_quarters <- function(x) {
  format(as.yearqtr(x), format = "%qT%Y")
}
```


```{r vacancyRate, fig.cap="Home Price Index, de Case e Shiller, em termos reais.", out.width="100%"}
recessions.trim = subset(recessions.df, Peak >= "1956-01-01" )
recessions.trim$Peak <- as.POSIXct(recessions.trim$Peak)
recessions.trim$Trough <- as.POSIXct(recessions.trim$Trough)
p1 <- ggplot(RHVRUSQ156N, aes(x = date, y = value)) +
  geom_line() +
   labs(
     title = "Imóveis próprios", 
     subtitle = "Não ajustada sazonalmente | Frequência: trimestral", 
     caption = "1956-2020",
     x = "Data", 
     y = "%") +
  stat_peaks(colour = "red", span = 25) +
  # stat_peaks(geom = "text", colour = "red", 
  #            vjust = -0.5, x.label.fmt = "%m/%y", span = 25) +
  stat_valleys(colour = "blue", span = 25) +
  # stat_valleys(geom = "text", colour = "blue", 
  #            vjust = 1.5, x.label.fmt = "%b/%Y", span = 25) +   
  scale_x_datetime(expand = expansion(mult = c(0, .05)),
                   date_breaks = "60 months",
                   date_minor_breaks = "12 months",
                   labels = format_quarters) +
  theme(panel.grid.major = element_line(colour="gray", size=0.5),
        panel.grid.minor.x = element_line(colour="gray", size=0.1),
        axis.text.x=element_text(angle=-45, hjust=0.001)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough,
                                    ymin=-Inf, ymax=+Inf),
          inherit.aes=F,
          fill='grey', alpha=0.5)
p2 <- ggplot(RRVRUSQ156N, aes(x = date, y = value)) +
  geom_line() +
   labs(
     title = "Imóveis de aluguel", 
     subtitle = "Não ajustada sazonalmente | Frequência: trimestral", 
     caption = "1956-2020",
     x = "Data", 
     y = "%") +
  stat_peaks(colour = "red", span = 61) +
  # stat_peaks(geom = "text", colour = "red", 
  #            vjust = -0.5, x.label.fmt = "%m/%y", span = 61) +
  stat_valleys(colour = "blue", span = 61) +
  # stat_valleys(geom = "text", colour = "blue", 
  #            vjust = 1.5, x.label.fmt = "%b/%Y", span = 61) +
  scale_x_datetime(expand = expansion(mult = c(0, .05)),
                   date_breaks = "60 months",
                   date_minor_breaks = "12 months",
                   labels = format_quarters) +
  theme(panel.grid.major = element_line(colour="gray", size=0.5),
        panel.grid.minor.x = element_line(colour="gray", size=0.1),
        axis.text.x=element_text(angle=-45, hjust=0.001)) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough,
                                    ymin=-Inf, ymax=+Inf),
          inherit.aes=F,
          fill='grey', alpha=0.5)
plot_row <- plot_grid(p1, p2)
title <- ggdraw() +
  draw_label(
    "Taxa de Vacância (EUA)",
    fontface = 'bold',
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 0)
  )
plot_grid(title, plot_row, ncol = 1,
          # rel_heights values control vertical title margins
          rel_heights = c(0.1, 1))
```
\bcenter
\small Fonte -- O autor, com dados obtidos do FRED [@RHVRUSQ156N; @RRVRUSQ156N].
\ecenter

Outra \gls{HMV} importante não citada por @macroHousing é a *Homeownership rate*,
*i.e* a proporção da população que vive em imóveis próprios. A Figura 
\@ref(fig:USHOWN) mostra a evolução da *Homeownership rate* desde 1984.

```{r USHOWN, fig.cap = "Proporção da população vivendo em imóveis próprios (\\gls{EUA})."}
ggplot(USHOWN, aes(x = date, y = value)) +
  geom_line() +
   labs(
     title = "Proporção da população vivendo em imóveis próprios (EUA)", 
     subtitle = "Não ajustada sazonalmente | Frequência: trimestral", 
     caption = "Desde 1984.",
     x = "Data", 
     y = "%") 
```
\bcenter
\small Fonte -- O autor, com dados obtidos do FRED [@RSAHORUSQ156S].
\ecenter

É usual encontrar análises sobre o \gls{MI} com estas séries plotadas num 
único gráfico [ver @FRED2014; @FRED2016; @FRED2018], como mostrado na Figura 
\@ref(fig:twoseries).

```{r twoseries, fig.cap = "Análise comparativa de séries de \\gls{HMV}.", out.width="100%"}
ushown <- as.xts(USHOWN[, 3], order.by = USHOWN$date)
nhpi <- as.xts(NHPI[, 3], order.by = NHPI$date)

## add extra space to right margin of plot within frame
par(mar=c(4, 4, 1, 6) + 0.1)

## Plot first set of data and draw its axis
plot(time(ushown), ushown$value, pch=20, axes=FALSE, cex = .25,
     ylim=c(63,70), xlab="", ylab="", type="l",col="black", 
     main=NULL)
axis(2, ylim=c(63,70),col="black",las=1)  ## las=1 makes horizontal labels
mtext("HouseOwnership (%)",side=2,line=2.5)
box()

## Allow a second plot on the same graph
par(new=TRUE)

## Plot the second plot and put axis scale on right
plot(time(nhpi), nhpi$value, pch=18,  cex = .25, 
     xlab="", ylab="", ylim=c(60, 270), 
     axes=FALSE, type="l", col="red")
## a little farther out (line=4) to make room for labels
mtext("HPI (2000 = 100)",side=4,col="red",line=4) 
axis(4, ylim=c(60, 270), col="red",col.axis="red",las=1)

## Draw the time axis
#axis.Date(1, range(time(ushown)), format = "%m/%Y")
axis.Date(1, at=seq(as.Date("1984/1/1"), as.Date("2020/1/1"), "years"), format = "%Y")
mtext("Ano", side = 1, col = "black", line = 2.5)  

## Add Legend
legend("topleft",legend=c("HomeOwnership","HPI"),
  text.col=c("black","red"),lty=rep(1, 2), col=c("black","red"))

# dualplot(x1 = time(ushown), y1 = ushown$value,
#         x2 = time(nhpi), y2 = nhpi$value)

# df <- inner_join(USHOWN, NHPI, by = "date", suffix = c(".USHOWN", ".NHPI"))
# coef <- 3
# 
# ggplot(df, aes(x=date)) +
#   
#   geom_line( aes(y=value.USHOWN), size=2, color="blue") + 
#   geom_line( aes(y=value.NHPI/coef), size=2, color="red") +
#   
#   scale_y_continuous(
#     
#     # Features of the first axis
#     name = "%",
#     
#     limits = c(63, 70),
#     
#     # Add a second axis and specify its features
#     sec.axis = sec_axis(~.*coef, name="NHPI - 2000=100")
#   ) + 
#   
#   theme(
#     axis.title.y = element_text(color = "blue", size=13),
#     axis.title.y.right = element_text(color = "red", size=13)
#   ) +
# 
#   ggtitle("Temperature down, price up")
```
\bcenter
\small Fonte -- O autor, com dados obtidos do FRED [@RSAHORUSQ156S; @CSUSHPINSA].
\ecenter

## Comportamento recente dos índices de preços e relação com \gls{MV} e \gls{HMV}

No Brasil não existem séries históricas de prazo satisfatórios para uma análise
de longo prazo referente ao preço dos imóveis. No entanto, como explicitado 
teoricamente no capítulo \@ref(historico), e mostrado por @ADAMS2010 numa
série de países, num mundo globalizado, em que há livre fluxo de capitais, a
tendência é que o comportamento dos preços siga uma mesma tendência, portanto a
análise do comportamento dos preços nos países centrais da economia mundial 
tende a representar o que ocorrerá, com maior ou menor *lag*, nos outros países,
influenciados pelas variáveis e decisões ocorridas nestes países.

### Uma análise do HPI de Case e Shiller

A figura \@ref(fig:nhpi) mostra a evolução do *Home Price Index* de Case e
Shiller, desde 1990. 

É possível notar pela análise do índice que os preços dos imóveis que, após o
estouro da bolha do *subprime*, os preços sofrem uma nítida tendência de
alta, desde janeiro de 2012, ultrapassando já, em termos nominais, os níveis de
preços anteriores à crise de 2008.

```{r}
nhpi <- readRDS("data/nhpi")
rhpi <- readRDS("data/rhpi")
```


```{r}
range_nhpi_2006_2012 <- range(window(nhpi, start = 2006 + 6/12, end = 2012 + 0/12))
range_rhpi_2005_2012 <- range(window(rhpi, start = 2005 + 11/12, end = 2012 + 0/12))
range_rhpi_1997_2005 <- range(window(rhpi, start = 1997 + 0/12, end = 2005 + 11/12))
range_rhpi_1989_1997 <- range(window(rhpi, start = 1989 + 7/12, end = 1997 + 0/12))
```

Em julho de 2006 o índice atingiu o valor de `r brf(range_nhpi_2006_2012[2])`
pontos, entrando então em tendência de baixa, até atingir os 
`r brf(range_nhpi_2006_2012[1])` pontos, em janeiro de 2012, uma queda de 
`r brf(diff(range_nhpi_2006_2012))` 
pontos, quando se iniciou nova tendência de alta, que perdura até os dias atuais. 
No momento em que se escreve esta dissertação o índice se encontra com 
`r brf(last(nhpi))` pontos, maior valor da série histórica, uma alta de 
`r brf(last(nhpi) - range_nhpi_2006_2012[1])`
pontos.

Em termos reais, no entanto, os preços ainda são inferiores ao pico registrado, 
mas há uma nítida tendência de alta, conforme pode ser visto na figura 
\@ref(fig:rhpi).

```{r rhpi, fig.cap="Home Price Index (HPI), de Case e Shiller, em termos reais."}
recessions.trim = subset(recessions.df, Peak >= "1990-01-01" )
ggplot(window(rhpi, start = 1990 + 0/12), as.numeric = FALSE) +
  geom_line() +
   labs(
     title = "Índice de Case-Shiller (EUA) HPI Nacional Real", 
     subtitle = "Não ajustado sazonalmente | Frequência: Mensal", 
     caption = "1990-2019",
     x = "Ano", 
     y = "Índice Jan 1890 = 100") +
  ylim(110, 200) +
  stat_peaks(colour = "red", span = 61) +
  stat_peaks(geom = "text", colour = "red", 
             vjust = -0.5, x.label.fmt = "%b/%Y", span = 61) +
  stat_valleys(colour = "blue", span = 61) +
  stat_valleys(geom = "text", colour = "blue", 
             vjust = 1.5, x.label.fmt = "%b/%Y", span = 61) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, 
                                    ymin=-Inf, ymax=+Inf),
          inherit.aes=F,
          fill='grey', alpha=0.5)
```
\bcenter
\small Fonte -- O autor, à partir de dados de @QuandlWIKI.
\ecenter

Na atualidade este índice se encontra em `r brf(last(rhpi))` pontos, sendo 
que o maior valor da série histórica se deu em dezembro de 2005, quando atingiu
`r brf(range_rhpi_2005_2012[2])` pontos.

Em janeiro de 1997, o índice estava em `r brf(range_rhpi_1989_1997[1])` pontos.
Desta data em diante, o índice entrou em franca tendência de alta até atingir os
`r brf(range_rhpi_2005_2012[2])` pontos, em dezembro de 2005, auge, em termos
reais, da bolha imobiliária, que no entanto só viria a estourar, nominalmente
falando, em julho de 2006, como se pode ver na figura \@ref(fig:nhpi).

É importante salientar que o fenômeno da alta tão relevante dos preços dos 
imóveis é relativamente recente. O gráfico da Figura \@ref(fig:rhpi2) ilustra 
isto: apesar de alguns períodos de picos e vales relevantes, no longo prazo, não
há uma tendência clara dos preços, até fins do século XX. Isto contrasta com as
séries de preços de ativos de renda variável, por exemplo. Em séries temporais,
usa-se o termo passei aleatório (*random walk*) para se referir à séries como o
HPI (até fins do século XX), onde não é possível estabelecer uma padrão claro de
ciclos ou uma tendência. Já para as séries de ativos de renda variável (ações) 
ou do \gls{PIB}, há evidências que há uma tendência de longo prazo (*drift*) na 
série, apesar da aleatoriedade.

De fato, @supplyelasticity [p. 290-291] mostraram que não há, ou melhor, não
havia, até a publicação daquele trabalho, tendência de longo prazo para o preço
dos imóveis nos \gls{EUA}. No entanto, o que se tem observado num período que
vai desde meados de princípios do século atual é que, ao menos graficamente,
existe uma clara e forte tendência de alta de preços, não apenas nos \gls{EUA},
como mostram a análise do HPI de Case e Shiller, mas também em nível global,
como mostra a Figura \@ref(fig:global-rhpi), do índice de preços global de
imóveis do \gls{FMI}, que será apresentado na próxima seção.

A possível presença de uma tendência de longo prazo para os preços dos imóveis
deve ser investigada. No capítulo \@ref(crise2008) isto será abordado.

```{r rhpi2, fig.cap="HPI, em termos reais."}
recessions.trim = subset(recessions.df, Peak >= "1953-01-01" )
ggplot(window(rhpi, start = 1953 + 0/12), as.numeric = FALSE) +
  geom_line() +
   labs(
     title = "Índice de Case-Shiller (EUA) HPI Nacional Real", 
     subtitle = "Não ajustado sazonalmente | Frequência: Mensal", 
     caption = "1953-2019",
     x = "Ano", 
     y = "Índice Jan 1890 = 100") +
  ylim(95, 205) +
  stat_peaks(colour = "red", span = 61) +
  stat_peaks(geom = "text", colour = "red", 
             vjust = -0.5, x.label.fmt = "%m/%Y", span = 61) +
  stat_valleys(colour = "blue", span = 61) +
  stat_valleys(geom = "text", colour = "blue", 
             vjust = 1.5, x.label.fmt = "%m/%Y", span = 61) +
  geom_rect(data=recessions.trim, aes(xmin=Peak, xmax=Trough, 
                                      ymin=-Inf, ymax=+Inf),
            inherit.aes=F,
            fill='grey', alpha=0.5)
```
\bcenter
\small Fonte -- O autor, à partir de dados de @QuandlWIKI.
\ecenter

O valor mínimo da série histórica (não mostrado no gráfico) foi atingido em  
`r month.abb[(time(rhpi)[which.min(rhpi)] %% 1)*12+1]` de 
`r floor(time(rhpi)[which.min(rhpi)])`, quando o índice atingiu a marca de 
`r brf(rhpi[which.min(rhpi)])` pontos.

É interessante notar que, em um século, desde 1890, o índice de preços reais de
imóveis atingiu um valor máximo de apenas `r brf(range_rhpi_1989_1997[2])`
pontos, o que ocorreu em agosto de 1989.

Ou seja, em relação ao topo histórico  de um século (agosto de 1989) à partir do
início da coleta do índice (1890), o índice hoje se encontra 
`r brf(last(rhpi) - range_rhpi_1989_1997[2])` pontos percentuais acima daquela 
marca e a apenas `r brf(range_rhpi_1989_1997[2] - last(rhpi))` pontos 
percentuais abaixo de atingir o topo histórico de dezembro de 2005.

Em janeiro de 2012, no fundo do vale da curva do índice real, este atingiu
`r brf(range_rhpi_2005_2012[1])` pontos, apenas 
`r brf(range_rhpi_1989_1997[2] - range_rhpi_2005_2012[1])` pontos abaixo do topo 
histórico de um século à partir de 1890.

### O Global Real House Price Index

O *Global Real House Price Index* do \gls{FMI}, que se constitui de uma média
simples de preços reais de residências em 57 países [@fmitwa], mostra também uma
nítida e forte tendência de alta, como pode ser observado na Figura 
\@ref(fig:global-rhpi).


```{r global-rhpi, fig.cap = "HPI real do FMI."}
# library(cowplot)
# theme_set(theme_cowplot(14))
format_quarters <- function(x) {
  format(as.yearqtr(x), format = "%qT%Y")
}
ggplot(global_rhpi, aes(x = dateq, y = equally.weighted)) +
  geom_line() +
   labs(
     title = "Índice Preço de Imóveis residenciais global FMI", 
     subtitle = "Não ajustado sazonalmente | Frequência: trimestral", 
     caption = "2000-2019",
     x = "Ano",
     y = "Índice") +
  stat_peaks(colour = "red", span = 25) +
  stat_peaks(geom = "text", colour = "red",
             vjust = -0.5, x.label.fmt = "%m/%Y", span = 25) +
  stat_valleys(colour = "red", span = 25) +
  stat_valleys(geom = "text", colour = "red",
             vjust = 1.5, x.label.fmt = "%m/%Y", span = 25) +
  scale_y_continuous(expand = c(0,20))+
  scale_x_datetime(expand = expansion(mult = c(0, .05)),
                   date_breaks = "12 months",
                   date_minor_breaks = "3 months",
                   labels = format_quarters) +
  theme(panel.grid.major = element_line(colour="gray", size=0.5),
        panel.grid.minor.x = element_line(colour="gray", size=0.1),
        axis.text.x=element_text(angle=-45, hjust=0.001))
#  stat_smooth()
```
\bcenter
\small Fonte -- O autor, à partir de dados de @QuandlWIKI.
\ecenter

Deve-se reparar que, ao contrário do que aconteceu nos \gls{EUA}, o pico em
termos globais só foi alcançado no último trimestre de 2007. Deve ser observado
ainda que a queda, em termos globais, foi muito menos abrupta que a queda
ocorrida nos \gls{EUA}. O ponto de retomada, no entanto, tem grande
coincidência: enquanto nos \gls{EUA} a retomada começa à partir de Jan/2012,
tanto para o índice nominal quanto para o índice real, globalmente esta retomada
ocorre à partir do final do primeiro trimestre de 2012. Se levar-se em conta
que, diferentemente dos índices norte-americanos, o índice global é trimestral,
pode-se dizer que a retomada global da alta dos preços dos imóveis é
praticamente simultânea.

No entanto, deve-se ter em conta que o preço dos imóveis nos \gls{EUA} afeta o
índice global.

